---
title: "Actividad Integradora 1"
author: "Eliezer Cavazos"
date: "2024-08-20"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


## Lectura Datos

```{r}

library(nortest)
library(e1071)
library(moments)
library(MASS)

oNutricion = read.csv("C:\\Users\\eliez\\OneDrive\\Desktop\\Clases\\food_data_g.csv") #leer la base de datos


oAgua = oNutricion$Water

```


## 1. Para analizar datos atípicos se te sugiere:

## Graficar el diagrama de caja y bigote

```{r}
par(mfrow=c(2,1))
boxplot(oAgua, horizontal = TRUE,col="pink", main="Agua en Alimentos")

```

## Calcula las principales medidas que te ayuden a identificar datos atípicos (utilizar summary te puede abreviar el cálculo): Cuartil 1, Cuartil 2, Media, Cuartil 3, Rango intercuartílico y Desviación estándar

```{r}
D0=ad.test(oAgua)

m0=round(c(as.numeric(summary(oAgua)),kurtosis(oAgua),skewness(oAgua),D0$p.value),3)


m<-as.data.frame(rbind(m0))
row.names(m)=c("Original")
names(m)=c("Minimo","Q1","Mediana","Media","Q3","Máximo","Curtosis","Sesgo","Valor p")

m
```




## Identifica la cota de 1.5 rangos intercuartílicos para datos atípicos, ¿hay datos atípicos de acuerdo con este criterio? ¿cuántos son?

```{r}
y1 = min(oAgua)
y2 = max(oAgua)

q1=quantile(oAgua,0.25)  #Cuantil 1 de la variable Agua
q2=quantile(oAgua,0.50)
q3 = quantile(oAgua, 0.75) # Cuartil 3
#ri= q3-q1   #o   
ri=IQR(oAgua)    #Rango intercuartílico de Agua

rangoCuartil1 = q1+1.5*ri
rangoCuartil2 = q2+1.5*ri
rangoCuartil3 = q3+1.5*ri

```

## Cuartil 1
```{r}
par(mfrow=c(2,1))  #Matriz de gráficos de 2x1
boxplot(oAgua,horizontal=TRUE)
abline(v=rangoCuartil1,col="red")  #linea vertical en el límite de los datos atípicos o extremos

oAguaClean= oAgua[oAgua<rangoCuartil1]  #En la matriz M, quitar datos más allá de 1.5 rangos intercuartílicos arriba de q3 de la variable Agua
summary(oAguaClean)
summary(oAgua)
```
## Cuartil 2
```{r}
par(mfrow=c(2,1))  #Matriz de gráficos de 2x1
boxplot(oAgua,horizontal=TRUE)
abline(v=rangoCuartil2,col="red")  #linea vertical en el límite de los datos atípicos o extremos

oAguaClean= oAgua[oAgua<rangoCuartil2]  #En la matriz M, quitar datos más allá de 1.5 rangos intercuartílicos arriba de q3 de la variable Agua
summary(oAguaClean)
summary(oAgua)
```
## Cuartil 3
```{r}
par(mfrow=c(2,1))  #Matriz de gráficos de 2x1
boxplot(oAgua,horizontal=TRUE)
abline(v=rangoCuartil3,col="red")  #linea vertical en el límite de los datos atípicos o extremos

oAguaClean= oAgua[oAgua<rangoCuartil3]  #En la matriz M, quitar datos más allá de 1.5 rangos intercuartílicos arriba de q3 de la variable Agua
summary(oAguaClean)
summary(oAgua)
```

```{r}
hist(oAgua, main = "Muestra de Datos de Agua")
```


## Identifica la cota de 3 desviaciones estándar alrededor de la media, ¿hay datos atípicos de acuerdo con este criterio? ¿cuántos son?

```{r}

media_Agua = mean(oAgua)
sd_Agua = sd(oAgua)

media_Agua
sd_Agua

min = media_Agua - (3 * sd_Agua)
max = media_Agua + (3 * sd_Agua)
min 
max
```


## Identifica la cota de 3 rangos intercuartílicos para datos extremos, ¿hay datos extremos de acuerdo con este criterio? ¿cuántos son?
## Interpreta los resultados obtenidos y argumenta sobre el comportamiento de los datos atípicos y extremos en la variable seleccionada

Hay muchos datos atipicos menores y no se muestra viabilidad a que se distribuya de manera normal los datos


## 2. Para analizar normalidad se te sugiere:

## Realiza pruebas de normalidad univariada para la variable (utiliza las pruebas de Anderson-Darling y de Jarque Bera). No olvides incluir H0 y H1 para la prueba de normalidad.

```{r}

ad.test(oAgua)

jarque.test(oAgua)
```


## Grafica los datos y su respectivo QQPlot: qqnorm(datos) y qqline(datos)

```{r}
qqnorm(oAgua)
qqline(oAgua)
```

## Calcula el coeficiente de sesgo y el coeficiente de curtosis

```{r}


sg_Agua = skewness(oAgua)
k_Agua = kurtosis(oAgua)

cat("Sesgo: ", sg_Agua)
cat(" Curtosis: ", k_Agua)
```


## Compara las medidas de media, mediana y rango medio de cada variable

```{r}
m
```


## Realiza el gráfico de densidad empírica y teórica suponiendo normalidad en la variable. Adapta el código:

```{r}
hist(oAgua,freq=FALSE)
lines(density(oAgua),col="red")
curve(dnorm(x,mean=media_Agua,sd=sd_Agua), add=TRUE, col="blue",lwd=2)
```


## Interpreta los gráficos y los resultados obtenidos en cada punto con vías a indicar si hay normalidad de los datos

Los graficos muestran que los datos no se pueden normalizar ya que tiene un sesgo muy grande a la derecha

## Comenta las características encontradas:

## Considera alejamientos de normalidad por simetría, curtosis

La curtosis es muy grande por lo que se puede decir que la grafica no sigue una distribucion normal

##Comenta si hay aparente influencia de los datos atípicos en la normalidad de los datos
Si hay una influencia de los datos atipicos en la normalidad de los datos y más de los datos atipicos iguales a 0 que los datos atipicos mayores al tercer cuartil
##Emite una conclusión sobre la normalidad de los datos. Se debe argumentar en términos de los 3 puntos analizados: las pruebas de normalidad, los gráficos y las medidas.
Las pruebas de normalidad muestran que el valor de P es muy bajo por lo que se rechaza la hipotesis

Los Graficos muestran mucho sesgo a la derecha y el grafico de qqplot muestra tambien que la mayoria de datos atipicos se encuentran en los valores menores

Las medidas de Sesgo y Curtosis demuestran que nuestos datos no son normales


## Punto 2. Transformación a normalidad

## Encuentra la mejor transformación de los datos para lograr normalidad. Puedes hacer uso de la transformación Box-Cox o de Yeo Johnson o el comando powerTransform para encontrar la mejor lambda para la transformación. Utiliza el modelo exacto y el aproximado de acuerdo con las sugerencias de Box y Cox para la transformación.


**Obtenemos Lambda**
```{r}
bc<-boxcox((oAgua+1)~1)# agarra Agua
lambdaAgua=bc$x[which.max(bc$y)]

lambdaAgua #Lambda
```
```{r}
library(VGAM)

agua1=sqrt(oAgua+1)

agua2<- yeo.johnson(oAgua, lambda = lambdaAgua)
hist(agua2,col=0,main="Histograma de Yeo Johnson")
hist(agua1,col=0,main="Histograma Original")

```



## Escribe las ecuaciones de los modelos de transformación encontrados.

Agua1 = $\sqrt{x+1}$
Agua2 = $\frac{(x+1)^{0.343434} - 1}{0.343434}$

## 3. Analiza la normalidad de las transformaciones obtenidas con los datos originales. Utiliza como argumento de normalidad:
## 3.1 Compara las medidas: Mínimo, máximo, media, mediana, cuartil 1 y cuartil 3, sesgo y curtosis.

```{r}
#agua2 = ((oAgua+1)^lambda-1)/lambdaSugar

D0=ad.test(oAgua)
D1=ad.test(agua1)
D2=ad.test(agua2)

m0=round(c(as.numeric(summary(oAgua)),kurtosis(oAgua),skewness(oAgua),D0$p.value),3)
m1=round(c(as.numeric(summary(agua1)),kurtosis(agua1),skewness(agua1),D0$p.value),3)
m2=round(c(as.numeric(summary(agua2)),kurtosis(agua2),skewness(agua2),D0$p.value),3)

m<-as.data.frame(rbind(m0, m1, m2))
row.names(m)=c("Original", "Transformacion 1", "Transformacion 2")
names(m)=c("Minimo","Q1","Mediana","Media","Q3","Máximo","Curtosis","Sesgo","Valor p")

m
```


## 3.2 Grafica las funciones de densidad empírica y teórica de los 2 modelos obtenidos (exacto y aproximado) y los datos originales.

```{r}
#agua1 = sqrt(oAguaClean+1)
#agua2 <- yeo.johnson(oAgua, lambda = lambdaAgua)

par(mfrow=c(3,1))
hist(agua1,col=0,main="Histograma de Agua 1")
hist(agua2,col=0,main="Histograma de Agua 2")
hist(oAgua,col=0,main="Histograma de Agua ORIGINAL")

```




## 3.3 Realiza la prueba de normalidad de Anderson-Darling y de Jarque Bera para los datos transformados y los originales

```{r}

print("Original")
jarque.test(oAgua)
D0

print("Transformacion 1")
jarque.test(agua1)
D1

print("Transformacion 2")
jarque.test(agua2)
D2
```


## Detecta anomalías y corrige tu base de datos (datos atípicos, ceros anámalos, etc).
```{r}
oAguaClean= oAgua[0<oAgua]#oAgua[oAgua<rangoCuartil3] # Se quitan datos atipicos más alla de 1.5 rangos intercuantilicos arriba de q3 de la variable Agua

oAguaClean = oAguaClean[oAguaClean<rangoCuartil3]


hist(oAgua, main = "Muestra de Datos de Agua ORIGINAL")
hist(oAguaClean, main = "Muestra de Datos de Agua SIN ATIPICOS")

```

## 5. Comenta la normalidad de las transformaciones obtenidas. Utiliza como argumento de normalidad:
## 5.1 Compara las medidas: Mínimo, máximo, media, mediana, cuartil 1 y cuartil 3, sesgo y curtosis.
```{r}
agua1 = sqrt(oAguaClean+1)
agua2 <- yeo.johnson(oAguaClean, lambda = lambdaAgua)

D0=ad.test(oAguaClean)
D1=ad.test(agua1)
D2=ad.test(agua2)

m0=round(c(as.numeric(summary(oAguaClean)),kurtosis(oAguaClean),skewness(oAguaClean),D0$p.value),3)
m1=round(c(as.numeric(summary(agua1)),kurtosis(agua1),skewness(agua1),D0$p.value),3)
m2=round(c(as.numeric(summary(agua2)),kurtosis(agua2),skewness(agua2),D0$p.value),3)

m<-as.data.frame(rbind(m0, m1, m2))
row.names(m)=c("Datos Limpios ORIGINAL", "Transformacion 1", "Transformacion 2")
names(m)=c("Minimo","Q1","Mediana","Media","Q3","Máximo","Curtosis","Sesgo","Valor p")

m
```

## 5.2 Obten el histograma de los 2 modelos obtenidos (exacto y aproximado) y de los datos originales.

```{r}
#agua1 = sqrt(oAguaClean+1)
#agua2 <- yeo.johnson(oAgua, lambda = lambdaAgua)

par(mfrow=c(3,1))
hist(agua1,col=0,main="Histograma de Agua 1")
hist(agua2,col=0,main="Histograma de Agua 2")
hist(oAguaClean,col=0,main="Histograma de Agua DATOS LIMPIOS")
```


## 5.3 Interpreta la prueba de normalidad de Anderson-Darling y Jarque Bera para los datos transformados y los originales

```{r}
print("----Original Datos Limpios----")
jarque.test(oAgua)
D0

print("----Transformacion 1----")
jarque.test(agua1)
D1

print("----Transformacion 2----")
jarque.test(agua2)
D2
```


## 5.4 Indica posibilidades de motivos de alejamiento de normalidad (sesgo, curtosis, datos atípicos, etc)

Los datos atipicos que estan afectando los datos son los datos 0 y los datos más alla de 1.5 rangos intercuantilicos arriba de q3 de la variable Agua 

## 6 Define la mejor transformación de los datos de acuerdo a las características de los modelos que encontraste. Toma en cuenta los criterios del inciso anterior para analizar normalidad y la economía del modelo.

La mejor transformacion que seria la Transformacion 1 porque es la transformacion con el Sesgo que más se acerca a 0, ademas de tener una menor Curtosis que define el numero de desviaciones estandar de la media.
