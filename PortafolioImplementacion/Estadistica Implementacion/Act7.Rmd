---
title: "7. Intervalos de confianza"
author: "Eliezer Cavazos"
date: "2024-08-21"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library("gplots")
```

## Problema 1
### Muestra que el nivel de confianza indica el porcentaje de intervalos de confianza extraídos de una misma población que contienen a la verdadera media a través de la simulación de intervalos:

### Haz la simulación de 150 muestras de tamaño 150 extraídas de una población normal con 
$ \mu = 70$ y $\sigma = 9 $


### Calcula el intervalo con un nivel de confianza del 97% para cada una de esas medias. Obtendrás 150 intervalos de confianza.
### Grafica los 150 intervalos de confianza
### Grafica la media poblacional ( = 70) como una linea horizontal
### Cuenta cuántos intervalos de confianza contienen a la verdadera media, ¿qué porcentaje representan?

```{r}
iN = 150
fSigma = 9
fMiu = 70
fAlfa = 0.03

ErrorEst = fSigma/sqrt(iN)  
xb = rnorm(iN, fMiu,ErrorEst)  #simulación de una muestra de tamaño n=100

E = abs(qnorm(0.03/2) * ErrorEst)

m = 150 #número de muestras de tamaño n=100
plotCI(1:m, xb, E, main="Gráfico de IC", xlab="m intervalos", ylab= "medias muestrales")
abline(h=fMiu, col="red")

pnorm(E)
```
El Porcentaje de 0.9446 se queda en 0.95

## Problema 2
Resuelve las dos partes del problema "El misterioso Helio".

Primera parte. Suponga que la porosidad al helio (en porcentaje) de muestras de carbón, tomadas de cualquier veta en particular, está normalmente distribuida con una desviación estándar verdadera de 0.75. Se sabe que 10 años atrás la porosidad media de helio en la veta era de 5.3 y se tiene interés en saber si actualmente ha disminuido. Se toma una muestra al azar de 20 especímenes y su promedio resulta de 4.85.

X : porosidad al helio

$\sigma = Desviacion estandar$

$X \sim N(\mu, \sigma=0.75)$


### Haga una estimación por intervalo con una confianza del 97% para el promedio de porosidad para evaluar si ha disminuido.
```{r}
fSigma = 0.75
fAlfa = 0.03 # Como se tienen un intervalor de confianza que es 97% se lo restamos al 100: 1 - 0.97
fXb = 4.85 # X barra
iN = 20

E = abs(qnorm(fAlfa/2)) * fSigma/sqrt(iN) # Como va a salir negativo usamos abs

A = fXb - E # Como es el inferior se resta E
B = fXb + E # Como es el valor superiro se suma E

cat("La verdadera media actual esta entre: ", A, " y ", B)
```

### Se toma otra muestra de tamaño 16. El promedio de la muestra fue de 4.56. Calcule el intervalo de confianza al 97% de confianza
```{r}
# NO se cambio alfa ni Sigma ya que continua del problema anterior
fXb2 = 4.56 # X barra
iN2 = 16

E2 = abs(qnorm(fAlfa/2)) * fSigma/sqrt(iN2) # Como va a salir negativo usamos abs

A2 = fXb2 - E2 # Como es el inferior se resta E
B2 = fXb2 + E2 # Como es el valor superiro se suma E

cat("La verdadera media actual esta entre: ", A2, " y ", B2)
```

### ¿Podemos afirmar que la porosidad del helio ha disminuido?

```{r}
plot(0, ylim=c(0,2+1), xlim=c(4,5.5), yaxt="n", ylab="Porosidad al helio") ## en xlim estamos poniendo de los limites(A,B, A2, B2) el valor minimo que seria 4 y el valor maximo que supere un poco el limite 5.5
axis(2, at=c(1,2), labels=c("n=20", "n=16"))

# Intervalos [Ai, Bi]
arrows(A, 1, B, 1, angle=90, code=3, length = 0.1, lwd = 2, col="blue")
arrows(A2, 2, B2, 2, angle=90, code=3, length = 0.1, lwd = 2, col="green")

# Media dentro del intervalo
points(fXb, 1, pch=19, cex=1.1, col="blue")
points(fXb2, 2, pch=19, cex=1.1, col="green")

abline(v=5.3, lty=3, col="red") # la porosidad media de helio en la veta era de 5.3 y queremos saber si bajo
```
Con esto podemos identificar que si ha disminuido

## Segunda parte. Suponga que la porosidad al helio (en porcentaje) de muestras de carbón, tomadas de cualquier veta en particular, está normalmente distribuida con una desviación estándar verdadera de 0.75.


### ¿Qué tan grande tiene que ser el tamaño de la muestra si se desea que el ancho del intervalo con un 95% de confianza no sobrepase de 0.4?

```{r}
fSigma = 0.75
fAlfa = 0.05 
E3 = 0.2 # 0.4 / 2

iN3 = ( (abs(qnorm(fAlfa/2)) *  fSigma ) / E3) ^ 2

iN3
```

Como nuestro tamaño de muestra maximo es 54.02 lo pasamos a 55


### ¿Qué tamaño de muestra necesita para estimar la porosidad promedio verdadera dentro de 0.2 unidades alrededor de la media muestral con una confianza de 99%?

```{r}
fSigma = 0.75
fAlfa = 0.01 
E4 = 0.2

iN4 = ( (abs(qnorm(fAlfa/2)) *  fSigma ) / E4) ^ 2

iN4
```
Como nuestro tamaño maximo es de 93.30 lo pasamos a 94

## Problema 3.
### Con el archivo de datos de El Marcapasos los intervalos de confianza para la media de las siguientes variables:
```{r}
oMarcaPasos = read.csv("C:\\Users\\eliez\\OneDrive\\Desktop\\Clases\\El marcapasos.csv") #leer la base de datos\
fAlpha = 0.05
```

### Intensidad de pulsos con Marcapasos (2 intervalos de confianza)
```{r}
oIntensidadConMarcaPasos = oMarcaPasos$Intensidad.de.pulso[oMarcaPasos$Marcapasos == "Con MP"]

fXbIntensidad = mean(oIntensidadConMarcaPasos)
fSigmaIntensidad = sd(oIntensidadConMarcaPasos)
iNIntensidad =   length(oIntensidadConMarcaPasos)

ErrorEstIntensidad = fSigmaIntensidad/sqrt(iNIntensidad)  

EIntensidad = abs(qnorm(fAlpha/2)) * ErrorEstIntensidad # Como va a salir negativo usamos abs

AIntensidad= fXbIntensidad - EIntensidad # Como es el inferior se resta E
BIntensidad = fXbIntensidad + EIntensidad # Como es el valor superiro se suma E

cat("La verdadera media actual esta entre los siguientes intervalos de confianza: ", AIntensidad, " y ", BIntensidad)

```
### Intensidad de pulsos SIN Marcapasos (2 intervalos de confianza)
```{r}
oIntensidadSinMarcaPasos = oMarcaPasos$Intensidad.de.pulso[oMarcaPasos$Marcapasos == "Sin MP"]

fXbIntensidad2 = mean(oIntensidadSinMarcaPasos)
fSigmaIntensidad2 = sd(oIntensidadSinMarcaPasos)
iNIntensidad2 =   length(oIntensidadSinMarcaPasos)

ErrorEstIntensidad2 = fSigmaIntensidad2/sqrt(iNIntensidad2)  

EIntensidad2 = abs(qnorm(fAlpha/2)) * ErrorEstIntensidad2 # Como va a salir negativo usamos abs

AIntensidad2 = fXbIntensidad2 - EIntensidad2 # Como es el inferior se resta E
BIntensidad2 = fXbIntensidad2 + EIntensidad2 # Como es el valor superiro se suma E

cat("La verdadera media actual esta entre los siguientes intervalos de confianza: ", AIntensidad2, " y ", BIntensidad2)

```

### Periodo entre pulso con Marcapasos (2 intervalos de confianza)
```{r}
oPeriodoConMarcaPasos = oMarcaPasos$Periodo.entre.pulsos[oMarcaPasos$Marcapasos == "Con MP"]
fXbPeriodo = mean(oPeriodoConMarcaPasos)
fSigmaPeriodo = sd(oPeriodoConMarcaPasos)
iNPeriodo = length(oPeriodoConMarcaPasos)

ErrorEstPeriodo = fSigmaPeriodo/sqrt(iNPeriodo)  


EPeriodo = abs(qnorm(fAlpha/2)) * ErrorEstPeriodo # Como va a salir negativo usamos abs

APeriodo = fXbPeriodo - EPeriodo # Como es el inferior se resta E
BPeriodo = fXbPeriodo + EPeriodo # Como es el valor superiro se suma E

cat("La verdadera media actual esta entre los siguientes intervalos de confianza: ", APeriodo, " y ", BPeriodo)
```

### Periodo entre pulso SIN Marcapasos (2 intervalos de confianza)
```{r}
oPeriodoSinMarcaPasos = oMarcaPasos$Periodo.entre.pulsos[oMarcaPasos$Marcapasos == "Sin MP"]
fXbPeriodo2 = mean(oPeriodoSinMarcaPasos)
fSigmaPeriodo2 = sd(oPeriodoSinMarcaPasos)
iNPeriodo2 = length(oPeriodoSinMarcaPasos)

ErrorEstPeriodo2 = fSigmaPeriodo2/sqrt(iNPeriodo2)  


EPeriodo2 = abs(qnorm(fAlpha/2)) * ErrorEstPeriodo2 # Como va a salir negativo usamos abs

APeriodo2 = fXbPeriodo2 - EPeriodo2 # Como es el inferior se resta E
BPeriodo2 = fXbPeriodo2 + EPeriodo2 # Como es el valor superiro se suma E

cat("La verdadera media actual esta entre los siguientes intervalos de confianza: ", APeriodo2, " y ", BPeriodo2)
```

## Grafica los intervalos de confianza obtenidos en "El marcapasos":
### Grafica en un mismo eje coordenado la intensidad de pulso con y sin marcapasos

```{r}
plot(0, ylim=c(0,2+1), xlim=c(0.15,0.25), yaxt="n", ylab="Intensidad de Pulso") ## en xlim estamos poniendo de los limites(A,B, A2, B2) el valor minimo que seria 4 y el valor maximo que supere un poco el limite 5.5
axis(2, at=c(1,2), labels=c("Con MP", "Sin MP"))

# Intervalos [Ai, Bi]
arrows(AIntensidad, 1, BIntensidad, 1, angle=90, code=3, length = 0.1, lwd = 2, col="blue")
arrows(AIntensidad2, 2, BIntensidad2, 2, angle=90, code=3, length = 0.1, lwd = 2, col="green")

# Media dentro del intervalo
points(fXbIntensidad, 1, pch=19, cex=1.1, col="blue")
points(fXbIntensidad2, 2, pch=19, cex=1.1, col="green")
```

### Grafica en un mismo eje coordenado el periodo entre pulso con y sin marcapasos
```{r}
plot(0, ylim=c(0,2+1), xlim=c(0.85,1.22), yaxt="n", ylab="Periodo entre Pulso") ## en xlim estamos poniendo de los limites(A,B, A2, B2) el valor minimo que seria 4 y el valor maximo que supere un poco el limite 5.5
axis(2, at=c(1,2), labels=c("Con MP", "Sin MP"))

# Intervalos [Ai, Bi]
arrows(APeriodo, 1, BPeriodo, 1, angle=90, code=3, length = 0.1, lwd = 2, col="blue")
arrows(APeriodo2, 2, BPeriodo2, 2, angle=90, code=3, length = 0.1, lwd = 2, col="green")

# Media dentro del intervalo
points(fXbPeriodo, 1, pch=19, cex=1.1, col="blue")
points(fXbPeriodo2, 2, pch=19, cex=1.1, col="green")
```
## Compara los intervalos obtenidos e interpreta los gráficos. Concluye sobre ambas variables en la presencia y ausencia de marcapasos

En ambas graficas se puede identifcar que la media es más grande en los valores "Sin MarcaPasos" ademas que sus intervalos de confianza son mas grandes, esto podria signifcar que los datos "Con MarcaPasos" tienen un menor error estandar a los datos "Sin MarcaPasos", esto nos dice que los datos "Con MarcaPasos" son ´más exactos